<!DOCTYPE html>
<html lang="en">
<!-- original template from here: http://voteapp.s3-website-us-east-1.amazonaws.com/ -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Help us choose a tee shirt for Werner- vote for your favorite!">
  <meta name="author" content="Randall Hunt">
  <title>Help us choose a tee shirt for Werner</title>
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.15/c3.min.css">
  <!-- Custom styles for this template -->
  <link href="narrow.css" rel="stylesheet">
  <style>
  #graph {
    padding:0 0 20px 0;
  }

  a {
    color: #FF9900;
  }
  a:hover {
  	color: #fff;
  }

  .lead {
    color:#fff;
    clear: both;
  }
  .c3-legend-item text {
    stroke: white;
  }
  .logo img {
	  width: 30%;
	  max-width: 200px;
  }
  html {
	  padding: 0px;
  }
  body {
	  background: #252c38;
	  background-image: url('images/background_stars.jpg');
	  background-size: cover;
	  background-position: center top;
	  padding: 20px 0px;
  }
  h2 {
	  font-size: 48px;
	  font-weight: bold;
	  margin-top: 0px;
  }
  .albumList {
	  list-style-type: none;
	  padding: 0px;
	  max-width: 800px;
	  margin: 0 auto;
  }
    .albumList li img {
	  width: 100%;
  }
  .werner {
	  position: relative;
	  margin-bottom: 10px;
	  max-width: 600px;
	  margin: 0 auto;
	  margin-top: 15px;
  }
  .album {
	  position: absolute;
	  width: 32%;
	  top: 60%;
	  left: 32%;
  }
  .clear {
	  clear: both;
  }
  footer {
	  font-size: 10px; 
	  font-style: italic;
	  color: #ccc;
	  margin-top: 10px;
  }
  </style>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>

	<div class="container">
		<div class="jumbotron2">
			
			<div class="logo">
				<img src="images/logo-aws.png" />
			</div><!-- /logo -->
			
			<h1>Help us choose a tee shirt for Werner!</h1>
						
			<h4 class="center">Text and vote:</h4>
			<a href="tel:+13862048956"><h2 class="row">+1 (386) 204-8956</h2></a>
		
			<p class="lead"> Choose your favorite shirt, and vote by texting us the shirt name.<br />You can choose from:
						
			<ul class="albumList">
				<li><img src="images/album_community-heroes.jpg" /><br />VM (Ghost in the Virtual Machine)</li>
				<li><img src="images/album_community-heroes.jpg" /><br />Route53 (Route53 Revisited))</li>
				<li><img src="images/album_community-heroes.jpg" /><br />Metadata (All Eyez on Metadata)</li>
				<li><img src="images/album_community-heroes.jpg" /><br />us-east-1 (us-east-1)</li>
				<li class="clear"><img src="images/album_community-heroes.jpg" /><br />Cache (Cache Rules Everything Around Me)</li>
				<li><img src="images/album_community-heroes.jpg" /><br />Community Heroes (Community Heroes)</li>
				<li><img src="images/album_community-heroes.jpg" /><br />Serverless (Nevermind the Servers, Here's Serverless)</li>
				<li><img src="images/album_community-heroes.jpg" /><br />Redshift (Born to Run Redshift)</li>
			</ul>
			<p class="lead">
				This is a simple demonstration of <a href="https://aws.amazon.com/lex/">Amazon Lex</a> and <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> and <a href="https://aws.amazon.com/fargate/">AWS Fargate</a>
			</p>

			
					</div><!-- /jumbotron2 -->
	
	
		<div class="row" style="border-bottom: 1px dotted #ccc; margin-bottom: 20px;">
			
			<div class="col-md-6">	
								
				<div id="chart"></div>
			</div> <!-- /col-md-12 -->
			
			<div class="col-md-6">
					
				<div class="werner">
					<img src="images/album_community-heroes.jpg" class="album" />
					<img src="images/werner-blank-shirt-outline.png" style="width: 100%;" />
		
				</div> <!-- /verner -->
			</div>
		
		</div> <!-- /row -->
		
		
		<div class="row" >
			
			<div class="col-md-12">

				<p>We do store a hash of your phone number to prevent people from voting more than once. We do not store the number itself.</p>
				<p>A Lex Bot listens to Twilio text messages voting for different tee shirts. An <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> function receives the votes from Lex and updates the totals in a <a href="https://aws.amazon.com/dynamodb">DynamoDB</a> table. Read more on how this is built on the <a href="https://aws.amazon.com/blogs/aws/new-amazon-connect-and-amazon-lex-integration/">AWS Blog</a>. Also, a big thanks to <a href="https://twitter.com/jbnunn">Jeff Nunn</a> for creating <a href="https://medium.com/aws-activate-startup-blog/building-dynamic-dashboards-using-lambda-and-dynamodb-streams-part-1-217e2318ae17">this template</a>.</p>	
			</div> <!-- /col-md-12 -->
		</div> <!-- /row -->
	</div> <!-- /container -->

	<footer>
		Made with ❤️ by <a href="https://twitter.com/jrhunt">@jrhunt</a>. Adapted for this demo by <a href="https://twitter.com/brentcontained">@brentcontained</a>. Code is <a href="https://github.com/brentley/best-editor-ever">here</a>.
	</footer>
  
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.92.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.15/c3.min.js"></script>
  <script>
AWS.config.region = 'us-east-1'; // Region
AWS.config.credentials = new AWS.CognitoIdentityCredentials({
  IdentityPoolId: 'us-east-1:7099f5c7-69c7-4e42-9bc4-8257662a4d3a'
});
var dynamodb = new AWS.DynamoDB();
var columns = [];
var chart = c3.generate({
  bindto: '#chart',
  data: {
    type: 'donut',
    columns: columns
  },
  color: {
    pattern: ["#4b96ff",
"#becf1b",
"#505ee6",
"#409700",
"#7c26a8",
"#01ae40",
"#cf3abc",
"#a0d74f",
"#ff6ecc",
"#266000",
"#d3a3ff",
"#cdab00",
"#64428c",
"#c4cc7d",
"#a60056",
"#009566",
"#a51121",
"#81c2ff",
"#c74d00",
"#007cb4",
"#ff9954",
"#9ad3a8",
"#863e02",
"#ff9a8c",
"#9a5757"]
  },
  tooltip: {
    format: {
      title: function(d) { return 'Votes'},
      value: function(value, ratio, id) {
        return value;
      }
    }
  },
  donut: {
    label: {
      format: function(value, ratio, id) {
        return value;
      }
    }
  }
});

function getData() {
  dynamodb.scan({TableName: 'tshirt-votes'}, function(err, data) {
    if (err) {
      console.log(err);
      return null;
    } else {
      // sort data since scan can be out of order
      var items = data['Items'].sort(function(a,b) {
        return a['name']['S'] < b['name']['S']
      });
      var new_columns = [];
      for(var i in data['Items']) {
        new_columns[i] = [
          data['Items'][i]['name']['S'],
          parseInt(data['Items'][i]['votes']['N'])
        ];
      }
      var update = false;
      if (columns.length > 0) {
        for(var i in columns) {
          if (new_columns[i][0] == columns[i][0] && new_columns[i][1] == columns[i][1]) {
            continue
          } else {
            columns = new_columns;
            update = true;
          }
        }
      } else {
        columns = new_columns;
        update = true;
      }
      if (update) {
        chart.load({
          columns: new_columns
        });
      }
    }
  });
}
document.addEventListener("DOMContentLoaded", function(event) {
  getData();
  setInterval(getData, 5000);
});
  </script>
</body>
</html>
